<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Prijslijsten | Teck</title>
  <link rel="stylesheet" href="css/style.css" />
  <!-- Firebase App -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <nav id="main-nav"></nav>

  <main class="content">
    <h1>Prijslijsten</h1>
    <p>Hier vind je een overzicht van onze actuele prijslijsten.</p>

    <section class="price-list">
      <h2>Producten & Diensten</h2>
      <table>
        <thead>
          <tr>
            <th>Product/Dienst</th>
            <th>Prijs</th>
            <th>Beschrijving</th>
            <th>Actie</th>
          </tr>
        </thead>
        <tbody id="productTableBody">
          <!-- Producten worden hier geladen -->
        </tbody>
      </table>
    </section>

    <section class="add-product" style="margin-top: 2rem;">
      <h3 id="formTitle">Nieuw product toevoegen</h3>
      <form id="productForm">
        <input type="text" id="productNaam" placeholder="Productnaam" required />
        <input type="text" id="productPrijs" placeholder="Prijs" required />
        <input type="text" id="productBeschrijving" placeholder="Beschrijving" required />
        <button type="submit">Opslaan</button>
        <button type="button" id="annuleerBtn" style="display:none;">Annuleren</button>
      </form>
    </section>
  </main>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBM03URLmymAoYM-RG9ke40YIrAvTrOuNY",
      authDomain: "teck-personnal.firebaseapp.com",
      projectId: "teck-personnal",
      storageBucket: "teck-personnal.appspot.com",
      messagingSenderId: "877076892450",
      appId: "1:877076892450:web:917be69a1428a8697f737b",
      measurementId: "G-88TT8R5S00"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const productForm = document.getElementById('productForm');
    const tbody = document.getElementById('productTableBody');
    const formTitle = document.getElementById('formTitle');
    const annuleerBtn = document.getElementById('annuleerBtn');

    let bewerkId = null;

    function laadProducten() {
      db.collection('producten').orderBy('naam').onSnapshot(snapshot => {
        tbody.innerHTML = '';
        snapshot.forEach(doc => {
          const product = doc.data();
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${product.naam}</td>
            <td>${product.prijs}</td>
            <td>${product.beschrijving}</td>
            <td>
              <button onclick="bewerkProduct('${doc.id}', '${product.naam}', '${product.prijs}', \`${product.beschrijving.replace(/`/g, '\\`')}\`)">‚úèÔ∏è</button>
              <button onclick="verwijderProduct('${doc.id}')">üóëÔ∏è</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      });
    }

    laadProducten();

    productForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const naam = document.getElementById('productNaam').value.trim();
      const prijs = document.getElementById('productPrijs').value.trim();
      const beschrijving = document.getElementById('productBeschrijving').value.trim();

      if (naam && prijs && beschrijving) {
        const productData = {
          naam,
          prijs,
          beschrijving,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        if (bewerkId) {
          db.collection('producten').doc(bewerkId).update(productData).then(() => {
            resetFormulier();
          }).catch(error => {
            alert('Fout bij bijwerken product: ' + error.message);
          });
        } else {
          productData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
          db.collection('producten').add(productData).then(() => {
            resetFormulier();
          }).catch(error => {
            alert('Fout bij toevoegen product: ' + error.message);
          });
        }
      }
    });

    function verwijderProduct(id) {
      if (confirm('Ben je zeker dat je dit product wilt verwijderen?')) {
        db.collection('producten').doc(id).delete()
          .then(() => console.log("Product verwijderd"))
          .catch(error => alert("Fout bij verwijderen: " + error.message));
      }
    }

    function bewerkProduct(id, naam, prijs, beschrijving) {
      document.getElementById('productNaam').value = naam;
      document.getElementById('productPrijs').value = prijs;
      document.getElementById('productBeschrijving').value = beschrijving;
      bewerkId = id;
      formTitle.textContent = "Product bewerken";
      annuleerBtn.style.display = "inline-block";
    }

    function resetFormulier() {
      productForm.reset();
      bewerkId = null;
      formTitle.textContent = "Nieuw product toevoegen";
      annuleerBtn.style.display = "none";
    }

    annuleerBtn.addEventListener('click', resetFormulier);

    fetch('nav.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('main-nav').innerHTML = data;
      });
  </script>
</body>
</html>
